import os
import glob

current_path = os.getcwd()

# Extract sample name from the single FASTQ file
raw_fastq = config["raw_fastq_single"]

def read_sample_names(file_path):
    with open(file_path, 'r') as f:
        return [line.split('\t')[0] for line in f]

# Extract sample names from barcodes_3end_txt
barcodes_5end_txt = config["barcodes_5end_txt"]
SAMPLES = read_sample_names(barcodes_5end_txt)

prefix = config["prefix"]

rule all:
    input:
        expand(os.path.join(current_path, "results", "00-prepare", "prepare_output", prefix + "_{sample}.fastq"), sample=SAMPLES),
        os.path.join(current_path, "results", "00-prepare", "prepare_output", config["outputprepare"] + ".fastq"),
        os.path.join(current_path, "results", "00-prepare", "prepare_output", "{output_name}_min.truncated").format(output_name=config["outputprepare"]),
        os.path.join(current_path, "results", "00-prepare", "prepare_output", "{output_name}_clipped.fastq").format(output_name=config["outputprepare"]),
        os.path.join(current_path, "results", "00-prepare", "prepare_output", "{output_name}_good.truncated").format(output_name=config["outputprepare"]),
        os.path.join(current_path, "results", "00-prepare", "{output_name}.fasta").format(output_name=config["outputprepare"])

include: "rules/fastx_concatenate_adapter_removal.smk"
include: "rules/strip_adapter_removal_prinseq.smk"